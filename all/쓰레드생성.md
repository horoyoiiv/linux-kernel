

# 리눅스의 쓰레드 구현  

* 쓰레드 : `열린 파일`, `메모리 주소 공간`을 공유하는 또 하나의 실행흐름.  

## 1. 리눅스에서의 쓰레드   
* 리눅스에서는 별도의 스레드 개념이 없이, 모든 프로세스로 쓰레드를 구현한다.  
* 리눅스에서는 쓰레드를 위한 별도의 자료구조가 있는 것이 아닌, **다른 프로세스와 특정 자원을 공유하는** 또 다른 프로세스이다.  
* 그렇기에 쓰레드도 자신만의 `task_struct`를 가짐.  

* 하나의 프로세스가 네 개의 쓰레드를 가진다면 리눅스에서는 단지 네 개의 프로세스가 존재하며, 네 개의 task_struct가 존재한다.  
* 이러한 각 프로세스는 일부 자원을 공유하도록 **설정**되어 있을뿐이다.  

## 2. 리눅스에서의 쓰레드 생성  
* clone(2)를 호출했을 때, 특정 자원을 공유하도록 추가적인 `플래그`를 더 넘겨준다.  
* clone(2) : child 프로세스를 생성할 때 사용된다. fork(2)와의 차이점 : clone(2)은 어떤 자원을 공유할지에 대한 정보를 넘겨줄 수 있다.  

```
clone(CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_SIGHAND, 0);
```
* 위의 코드는 `메모리 주소 공간`, `파일 시스템 자원`, `파일 디스크립터`, `시그널 핸들러`를 공유하도록 설정한 것.  

```
// fork 호출 시
clone(SIGCHLD, 0);
// vfork 호출 시
clone(CLONE_VFORK | CLONE_VM | SIGCHLD, 0);
```


